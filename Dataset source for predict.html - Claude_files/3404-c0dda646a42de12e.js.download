"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3404],{10158:(e,t,n)=>{n.d(t,{g:()=>s});var a=n(54568);let s=e=>{let{height:t,className:n}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 139 34",className:n,height:t,fill:"currentColor","aria-label":"Claude",children:(0,a.jsx)("path",{d:"M18.07 30.79c-5.02 0-8.46-2.8-10.08-7.11a19.2 19.2 0 0 1-1.22-7.04C6.77 9.41 10 4.4 17.16 4.4c4.82 0 7.78 2.1 9.48 7.1h2.06l-.28-6.9c-2.88-1.86-6.48-2.81-10.87-2.81-6.16 0-11.41 2.77-14.34 7.74A16.77 16.77 0 0 0 1 18.2c0 5.53 2.6 10.42 7.5 13.15a17.51 17.51 0 0 0 8.74 2.06c4.78 0 8.57-.91 11.93-2.5l.87-7.62h-2.1c-1.26 3.48-2.76 5.57-5.25 6.68-1.22.55-2.76.83-4.62.83Zm21.65-26.4.2-3.39H38.5l-6.33 1.9v1.02l2.8 1.3v23.79c0 1.62-.82 1.98-3 2.25V33h10.75v-1.74c-2.17-.27-3-.63-3-2.25V4.4Zm42.75 29h.83l7.27-1.38v-1.78l-1.03-.07c-1.7-.16-2.13-.52-2.13-1.9V15.58l.2-4.07h-1.15l-6.87.99v1.73l.67.12c1.85.28 2.4.8 2.4 2.1v11.3C80.9 29.13 79.2 30 77.19 30c-2.26 0-3.64-1.15-3.64-3.8V15.58l.2-4.07h-1.19l-6.87.99v1.73l.71.12c1.86.28 2.41.8 2.41 2.1v10.43c0 4.42 2.49 6.52 6.48 6.52 3.04 0 5.53-1.62 7.39-3.88l-.2 3.88Zm-20-14.06c0-5.65-3-7.82-8.4-7.82-4.79 0-8.27 1.97-8.27 5.25 0 1 .36 1.74 1.07 2.25l3.64-.47c-.16-1.1-.24-1.78-.24-2.05 0-1.86.99-2.8 3-2.8 2.97 0 4.47 2.09 4.47 5.44v1.11l-7.51 2.25c-2.49.67-3.91 1.27-4.86 2.65a5 5 0 0 0-.71 2.8c0 3.2 2.21 5.46 5.97 5.46 2.72 0 5.13-1.23 7.23-3.56.75 2.33 1.9 3.56 3.95 3.56 1.66 0 3.16-.68 4.5-1.98l-.4-1.38c-.59.16-1.14.23-1.73.23-1.15 0-1.7-.9-1.7-2.68v-8.26Zm-9.6 10.87c-2.05 0-3.31-1.19-3.31-3.28 0-1.43.67-2.26 2.1-2.73l6.08-1.94v5.85c-1.94 1.46-3.08 2.1-4.86 2.1Zm63.3 1.81v-1.78l-1.02-.07c-1.7-.16-2.14-.52-2.14-1.9V4.4l.2-3.4h-1.42l-6.32 1.9v1.02l2.8 1.3v7.83a8.84 8.84 0 0 0-5.37-1.54c-6.28 0-11.18 4.78-11.18 11.93 0 5.89 3.51 9.96 9.32 9.96 3 0 5.61-1.47 7.23-3.72l-.2 3.72h.83l7.27-1.39Zm-13.15-18.13c3 0 5.25 1.74 5.25 4.94v9a7.2 7.2 0 0 1-5.21 2.1c-4.31 0-6.48-3.4-6.48-7.94 0-5.1 2.48-8.1 6.44-8.1Zm28.52 4.5c-.55-2.64-2.17-4.15-4.42-4.15-3.36 0-5.7 2.53-5.7 6.17 0 5.37 2.85 8.85 7.44 8.85a8.6 8.6 0 0 0 7.38-4.35l1.35.36c-.6 4.66-4.82 8.14-10 8.14-6.08 0-10.27-4.5-10.27-10.9 0-6.45 4.54-11 10.63-11 4.54 0 7.74 2.73 8.77 7.48l-15.84 4.85V21.7l10.66-3.32Z"})})}},15393:(e,t,n)=>{n.d(t,{f:()=>i});var a=n(64328),s=n(35984),l=n(68067),r=n(7620),o=n(10369);let i=function(){let{artifactContext:e,onRateLimitError:t,onMissingOrganization:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,l.fS)("apps_use_turmeric"),{activeOrganization:c}=(0,a.YL)(),{addError:d}=(0,s.Y)(),u=(0,o.A)();return(0,r.useCallback)(async a=>{if(!i)return Promise.resolve(null);if(!(null==c?void 0:c.uuid))return null==n||n(),Promise.resolve(null);try{var s;let n=await fetch("/api/organizations/".concat(null==c?void 0:c.uuid,"/proxy/v1/messages"),{method:"POST",headers:{"Content-Type":"application/json",...e?{"anthropic-artifact-id":e.uuid,"anthropic-artifact-entity-type":e.type}:{}},body:JSON.stringify({messages:[{role:"user",content:a}]})});if(!n.ok)throw 429===n.status&&(t?t():d(u.formatMessage({defaultMessage:"Limit reached. This artifact uses Claude for responses. Try again when the message limit resets.",id:"5Ocu9uCFLz"}),{messageForLogging:"Limit reached. This artifact uses Claude for responses. Try again when the message limit resets."})),Error("HTTP error! status: ".concat(n.status));let l=await n.json();return Promise.resolve((null==(s=l.content[0])?void 0:s.text)||null)}catch(e){return Promise.reject(e)}},[null==c?void 0:c.uuid,e,i,t,n,d,u])}},19757:(e,t,n)=>{n.d(t,{I:()=>F});var a=n(2348),s=n(54568),l=n(82028),r=n(35984),o=n(26819),i=n(13750),c=n(84284),d=n(59922),u=n(21266),m=n(89626),h=n(23812),g=n(66716),f=n(3075),p=n(84617),v=n(67453),x=n(19977),y=n(39500),j=n(72902),b=n(27541),w=n(7620),C=n(10369),k=n(59666),N=n(85028),M=n(13644),S=n(12142),_=n(10665),A=n(85705),E=n(45271),T=n(39383),P=n(35580);function R(){let e=(0,a._)(["\n  bg-bg-000 \n  border-0.5 \n  border-border-300 \n  rounded-lg \n  shadow-sm\n  p-5\n  flex \n  flex-col \n  gap-4\n  items-stretch\n  self-stretch\n"]);return R=function(){return e},e}let z=d.J.div(R()),L=e=>{let{isOpen:t,onClose:n,variant:a,unknownServerCount:l}=e,r=(0,C.A)();return(0,s.jsxs)(f.aF,{title:r.formatMessage({defaultMessage:"Connectors unavailable",id:"nKB/o0ajrR"}),isOpen:t,onClose:n,children:[(0,s.jsx)("div",{className:"flex flex-col gap-3 py-3",children:(0,s.jsx)(z,{children:(0,s.jsx)("p",{className:"text-sm text-text-500",children:"disabled"===a?(0,s.jsx)(k.A,{defaultMessage:"Your organization admin has disabled connectors in artifacts. To use this feature, ask your admin to enable connectors in artifacts.",id:"+0AXIvgEHO"}):(0,s.jsx)(k.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:l||0,link:(0,s.jsx)(p.Y,{href:"/settings/connectors",children:(0,s.jsx)(k.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})})}),(0,s.jsx)(f.vW,{children:(0,s.jsx)(h.$,{variant:"primary",onClick:n,children:(0,s.jsx)(k.A,{defaultMessage:"Close",id:"rbrahOGMC3"})})})]})},O=e=>{var t,n,a;let{server:l,variant:r,onClick:i,enabledToolsCount:d,artifactId:u,versionUuid:g,isInDirectory:f=!1,onToggleAll:y,pendingAfterOAuth:b=!1}=e,C=(0,S.Q)({queryString:u?"artifactId=".concat(encodeURIComponent(u),"&versionUuid=").concat(encodeURIComponent(g||"")):""}),[N,M]=(0,w.useState)(!1),_=N||l.isConnecting||b||!1;return(0,w.useEffect)(()=>{l.isConnected&&M(!1)},[l.isConnected]),(0,s.jsxs)("div",{className:(0,j.A)("w-full flex items-center justify-between rounded-lg bg-bg-000",i&&"connect"!==r&&"unavailable"!==r&&"loading"!==r&&"cursor-pointer hover:bg-bg-100 transition-colors"),onClick:"connect"===r||"unavailable"===r||"loading"===r?void 0:i,children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,s.jsx)(E.z,{size:28,imageSize:16,type:"favicon",src:l.url,name:l.name||l.url}),(0,s.jsxs)("div",{className:"flex gap-2 items-center min-w-0 flex-1",children:[(0,s.jsx)(v.Tooltip,{tooltipContent:l.url||l.name||"",children:(0,s.jsx)("div",{className:"font-medium text-sm truncate",children:l.name||l.url||""})}),!f&&(0,s.jsx)(o.E,{className:"flex-shrink-0",children:(0,s.jsx)(k.A,{defaultMessage:"CUSTOM",id:"Jg/zGahNtM"})})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:"connect"===r?(0,s.jsx)(h.$,{variant:"secondary",size:"sm",onClick:e=>{e.stopPropagation(),M(!0),C({uuid:l.uuid||"",url:l.url})},loading:_,className:"ml-2",children:(0,s.jsx)(k.A,{defaultMessage:"Connect",id:"+vVZ/G11Zg"})}):"loading"===r?(0,s.jsx)(h.$,{variant:"secondary",size:"sm",loading:!0,disabled:!0,className:"ml-2",children:(0,s.jsx)(k.A,{defaultMessage:"Connecting",id:"6q3tCnkd2h"})}):"unavailable"===r?(0,s.jsxs)("div",{className:"flex items-center gap-1 ml-2",children:[(0,s.jsx)(h.$,{variant:"secondary",size:"sm",disabled:!0,children:(0,s.jsx)(k.A,{defaultMessage:"Unavailable",id:"UpwcFdTuii"})}),(0,s.jsx)(v.Tooltip,{tooltipContent:(0,s.jsx)(k.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"}),children:(0,s.jsx)(p.Y,{href:"/settings/connectors",className:"text-fg-400 hover:text-fg-300 transition-colors p-1",children:(0,s.jsx)(m.$rp,{className:"w-4 h-4"})})})]}):"toggle"===r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("label",{onClick:e=>e.stopPropagation(),children:(0,s.jsx)(c.j,{checked:d===((null==(t=l.tools)?void 0:t.length)||0)&&((null==(n=l.tools)?void 0:n.length)||0)>0,onChange:()=>{var e;let t=(null==(e=l.tools)?void 0:e.length)||0,n=d===t&&t>0;null==y||y(!n)}})}),(0,s.jsx)(x.J,{className:"w-4 h-4 text-fg-400"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.E,{children:(0,s.jsx)("span",{className:"text-accent-secondary-200",children:(0,s.jsx)(k.A,{defaultMessage:"{enabled} of {total}",id:"ln8LiF3/8T",values:{enabled:d,total:(null==(a=l.tools)?void 0:a.length)||0}})})}),(0,s.jsx)(x.J,{className:"w-4 h-4 text-fg-400"})]})})]})},F=e=>{let{isOpen:t,requestedServers:n,onClose:a,artifactContext:o}=e,c=(0,C.A)(),d=(0,P.Uz)(),{isRemoteServerInDirectory:v}=(0,T.hW)(),x=(0,b.useSearchParams)(),j=x.get("server"),S="success"===x.get("step")&&!!j,E=(0,w.useRef)(v);E.current=v;let{addError:R}=(0,r.Y)(),F=c.formatMessage({defaultMessage:"Failed to save tool configuration. Please try again.",id:"ZohwwHXd08"}),{data:I}=(0,M.rX)(),U=!(null==I?void 0:I.disabled_features.includes("mcp_artifacts")),[D,K]=(0,w.useState)(null),[Z,Y]=(0,w.useState)(""),[$,H]=(0,w.useState)({}),{data:q}=(0,N.mt)({entityId:o.uuid,artifactEntityType:o.type}),{connectorServers:J,directoryServers:X,unknownServers:B}=(0,w.useMemo)(()=>{if(!d)return{connectorServers:[],directoryServers:[],unknownServers:[]};let e=[...n||[]],t=new Set((null==n?void 0:n.map(e=>e.url).filter(Boolean))||[]);(null==q?void 0:q.mcp_servers)&&q.mcp_servers.forEach(n=>{t.has(n.url)||e.push({name:n.name,url:n.url})});let a=[],s=[],l=[];return e.forEach(e=>{let t=d.find(t=>{let n="remote"===t.type,a=t.url===e.url;return n&&a});t?a.push(t):E.current(e)?s.push(e):l.push(e)}),{connectorServers:a,directoryServers:s,unknownServers:l}},[n,d,q]),G=(0,_.vP)("enabled_mcp_tools"),V=(0,w.useMemo)(()=>G||{},[G]),{mutateAsync:W}=(0,N.XJ)({entityId:o.uuid,artifactEntityType:o.type}),Q=(0,w.useCallback)(e=>e.tools?Z?e.tools.filter(e=>e.name.toLowerCase().includes(Z.toLowerCase())):e.tools:[],[Z]);if((0,w.useEffect)(()=>{if((null==q?void 0:q.mcp_servers)&&(null==J?void 0:J.length)){let e={};q.mcp_servers.forEach(t=>{let n=J.find(e=>e.url===t.url);(null==n?void 0:n.tools)&&n.tools.forEach(n=>{let a=t.allowed_tools.includes(n.name);e[n.enabledKey]=a})}),H(e)}else Object.keys(V).length>0&&H(V)},[q,J,V]),!J.length&&!X.length&&!B.length)return a(),null;if(!J.length&&!X.length)return(0,s.jsx)(L,{isOpen:t,onClose:a,variant:"empty",unknownServerCount:B.length});let ee=J.filter(e=>e.isConnected),et=e=>e.tools&&0!==e.tools.length?e.tools.filter(e=>!1!==$[e.enabledKey]).length:null,en=ee.filter(e=>{let t=et(e);return null!==t&&t>0}).length,ea=async e=>{try{await es(e),a()}catch(e){R(F,{error:e,errorContext:{tags:{source:"artifact_mcp_tool_config_save"}}})}},es=async e=>{let t=J.map(t=>{let n=t.tools||[],a=[],s=[],l=t.isConnected;return e&&n.length>0&&l?n.forEach(e=>{!1!==$[e.enabledKey]?a.push(e.name):s.push(e.name)}):!e&&n.length>0&&n.forEach(e=>{s.push(e.name)}),{name:t.name||"",url:t.url||"",allowed_tools:a,disallowed_tools:s,pending_tool_section:!!e&&!l}}),n=[...X,...B].map(e=>({name:e.name||"",url:e.url||"",allowed_tools:[],disallowed_tools:[],pending_tool_section:!1}));await W({mcp_servers:[...t,...n]})},el=e=>!!e.tools&&0!==e.tools.length&&e.tools.filter(e=>!1!==$[e.enabledKey]).length>0;return D?(0,s.jsx)(f.aF,{title:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>K(null),className:"hover:bg-bg-200 rounded transition-colors",children:(0,s.jsx)(y.A,{className:"w-5 h-5"})}),(0,s.jsx)("span",{children:(0,s.jsx)(k.A,{defaultMessage:"Customize {serverName}",id:"xtLJnxdHqO",values:{serverName:D.name||D.url||""}})})]}),isOpen:t,onClose:a,children:(0,s.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,s.jsx)("p",{className:"text-sm description-text-300",children:(0,s.jsx)(u.YX,{id:"crystal_muffin_bicycle"})}),(0,s.jsx)(g.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,s.jsxs)(z,{className:"!gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2.5 px-1.5",children:[(0,s.jsx)(m.vji,{className:"w-4 h-4 text-text-500/50"}),(0,s.jsx)(i.ks,{placeholder:c.formatMessage({defaultMessage:"Search tools",id:"QVlai1/dYD"}),value:Z,onChange:e=>Y(e.target.value),className:"flex-1 !border-none !outline-none !p-0 !text-sm text-text-300 placeholder:text-text-500/70"})]}),D.tools&&D.tools.length>1&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.$,{item:{key:"select-all",type:"switch",label:el(D)?c.formatMessage({defaultMessage:"Disable all tools",id:"8A9N39nihk"}):c.formatMessage({defaultMessage:"Enable all tools",id:"x4/g36jIjW"}),icon:(0,s.jsx)(l.p,{letter:D.tools[0].name,size:16}),isChecked:el(D),onClick:()=>{let e=!el(D);if(D.tools){let t={...$};D.tools.forEach(n=>{t[n.enabledKey]=e}),H(t)}}}}),(0,s.jsx)("div",{className:"border-t border-border-300"})]}),Q(D).map(e=>{let t=e.enabledKey,n=!1!==$[t];return(0,s.jsx)(A.$,{item:{key:t,type:"switch",label:e.name,icon:(0,s.jsx)(l.B,{letter:e.name,size:16}),isChecked:n,onClick:()=>{H(e=>({...e,[t]:!n}))}}},t)})]})})]})}):U?(0,s.jsxs)(f.aF,{title:c.formatMessage({defaultMessage:"Allow access to connectors",id:"5yCBRk9i5t"}),isOpen:t,onClose:a,children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,s.jsx)("p",{className:"text-sm description-text-300",children:(0,s.jsx)(u.YX,{id:"penguin_tomato_umbrella"})}),(0,s.jsx)(g.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsxs)(z,{children:[J.map(e=>{var t;let n,a=ee.includes(e),l=S&&e.uuid===j&&!a,r=e.isConnecting||l||!1,i=et(e),c=(null==(t=e.tools)?void 0:t.length)||0;return n=r?"loading":a?0===i||i===c?"toggle":"tools":"connect",(0,s.jsx)(O,{server:e,variant:n,onClick:()=>K(e),enabledToolsCount:i,artifactId:o.id,versionUuid:o.uuid,isInDirectory:"remote"===e.type&&E.current(e),onToggleAll:t=>((e,t)=>{if(e.tools){let n={...$};e.tools.forEach(e=>{n[e.enabledKey]=t}),H(n)}})(e,t),pendingAfterOAuth:l},e.uuid||e.url)}),X.length>0&&(0,s.jsxs)(s.Fragment,{children:[J.length>0&&(0,s.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),X.map(e=>(0,s.jsx)(O,{server:e,variant:"unavailable",isInDirectory:!0},e.url))]}),B.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),(0,s.jsx)("p",{className:"text-xs text-text-500",children:(0,s.jsx)(k.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:B.length,link:(0,s.jsx)(p.Y,{href:"/settings/connectors",children:(0,s.jsx)(k.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})]})]}),(0,s.jsx)(z,{className:"bg-bg-100",children:(0,s.jsx)("p",{className:"text-sm text-text-500",children:(0,s.jsx)(k.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})})]})})]}),(0,s.jsx)(f.vW,{children:en>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.$,{variant:"secondary",onClick:a,children:(0,s.jsx)(k.A,{defaultMessage:"Not now",id:"dUCA4Khx0S"})}),(0,s.jsx)(h.$,{onClick:()=>ea(!0),variant:"primary",children:(0,s.jsx)(k.A,{defaultMessage:"Continue with {count, plural, one {# connector} other {# connectors}}",id:"YL3kaz513s",values:{count:en}})})]}):(0,s.jsx)(h.$,{onClick:()=>ea(!0),variant:"primary",children:(0,s.jsx)(k.A,{defaultMessage:"Continue without connectors",id:"0AAuZbbfFT"})})})]}):(0,s.jsx)(L,{isOpen:t,onClose:a,variant:"disabled"})}},56054:(e,t,n)=>{n.d(t,{CodeRenderer:()=>E,k:()=>A,MarkdownRenderer:()=>T});var a=n(54568),s=n(90732),l=n(11727),r=n(78334),o=n(69604),i=n(57820),c=n(80870),d=n(49953),u=n(57291),m=n(49982),h=n(72902),g=n(7620),f=n(29820),p=n(74813),v=n(89626),x=n(23812),y=n(47592),j=n(39109),b=n(61295),w=n(10369),C=n(59666);let k=e=>{let{isStreaming:t,children:n,...s}=e;return t?n:(0,a.jsx)(N,{...s,children:n})},N=e=>{let{children:t,sendMessage:n,contentType:s="text",isOpen:l}=e,r=(0,w.A)(),o=(0,p.st)(),i=void 0!==n,[c,d]=(0,g.useState)([]),[u,m]=(0,g.useState)({top:0,left:0,width:0}),[f,k]=(0,g.useState)(!1),[N,M]=(0,g.useState)(!1),[S,_]=(0,g.useState)(""),[A,E]=(0,g.useState)(""),[T,P]=(0,g.useState)(!1),R=(0,g.useRef)(null),z=(0,g.useRef)(null),L=(0,g.useCallback)((e,t)=>{var n;let a=function(e,t){let n=[];for(let a=0;a<e.rangeCount;a++){let s=e.getRangeAt(a);if(s.startContainer===s.endContainer&&s.startContainer.nodeType===Node.TEXT_NODE){let e=s.startContainer,t=document.createRange();for(let a=s.startOffset;a<s.endOffset;a++){t.setStart(e,a),t.setEnd(e,a+1);let s=Array.from(t.getClientRects());n.push(...s)}t.detach()}else{let e=function(e){let t,n=[],a=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=a.nextNode();)n.push(t);return n}(s);e.forEach((a,l)=>{let r=document.createRange(),o="length"in a?a.length:0,i=0===l,c=l===e.length-1,d=i?s.startOffset:0,u=c&&!t?s.endOffset:o;r.setStart(a,d),r.setEnd(a,u);let m=Array.from(r.getClientRects());n.push(...m),r.detach()})}}return n}(e,t),s=null==(n=R.current)?void 0:n.getBoundingClientRect();return Array.from(a).map(e=>({top:e.top-((null==s?void 0:s.top)||0)-2.5,left:e.left-((null==s?void 0:s.left)||0),width:e.width,height:e.height+5.5}))},[]),O=(0,g.useCallback)(e=>{var t;let n=e.getRangeAt(0);return null==(t=R.current)?void 0:t.contains(n.commonAncestorContainer)},[]);(0,g.useEffect)(()=>{function e(e){var t,n,a,s;let l,r,{selection:o,isSelectAll:i}=e,c=L(o,i);if(c.every((e,t,n)=>0===t||5>Math.abs(e.top-n[0].top))){let e=Math.max(...c.map(e=>e.left+e.width));l=c[0].top-9,r=e+10}else{let e=Math.max(...c.map(e=>e.top+e.height));r=Math.min(...c.map(e=>e.left)),l=Math.min((null!=(a=null==(n=R.current)?void 0:n.scrollHeight)?a:0)-50,e)}let u=((null!=(s=null==(t=R.current)?void 0:t.scrollWidth)?s:1e3)-r)/3*2;d(c),k(!0),M(!1),m({top:l,left:r,width:u}),E(o.toString())}let t=()=>{P(!0)},n=t=>{"Escape"===t.key&&(M(!1),k(!1),_(""),d([]));let n=((0,y.cX)()?t.metaKey:t.ctrlKey)&&"a"===t.key,a=R.current;if(a&&l&&n){let n=document.activeElement&&(document.activeElement===a||(null==a?void 0:a.contains(document.activeElement))),s=window.getSelection();if(n&&s){t.preventDefault();let n=document.createRange();n.selectNodeContents(a),s.removeAllRanges(),s.addRange(n),e({selection:s,isSelectAll:!0})}}},a=t=>{if(z.current&&z.current.contains(t.target))return;let n=window.getSelection();n&&!n.isCollapsed&&O(n)?e({selection:n}):(d([]),k(!1),M(!1),E(""),_("")),P(!1)};return i&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",a),document.addEventListener("keydown",n)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",a),document.removeEventListener("keydown",n)}},[L,O,i,l]);let F=e=>{i&&(n(e),_(""),M(!1),k(!1),d([]))},I=()=>"text"===s?A.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===s?"```\n".concat(A,"\n```"):void 0,U=()=>{F({prompt:"".concat(I(),"\n\n").concat(S),attachments:[],files:[],syncSources:[]})};return(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)("div",{ref:R,tabIndex:0,className:(0,h.$)("w-full h-full relative",i?T?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),c.map((e,t)=>(0,a.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,a.jsx)(j.N,{children:f&&!N&&(0,a.jsx)(b.P.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:u.top+5,left:u.left},children:(0,a.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,a.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,a.jsx)(x.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"improve"}),M(!0)},prepend:(0,a.jsx)(v.XGh,{}),children:(0,a.jsx)(C.A,{defaultMessage:"Improve",id:"BATKcMm/a2"})}),(0,a.jsx)(x.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"explain"}),F({prompt:"".concat(r.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(I()),attachments:[],files:[],syncSources:[]})},prepend:(0,a.jsx)(v.g5W,{}),children:(0,a.jsx)(C.A,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})})]})})})}),(0,a.jsx)(j.N,{children:N&&(0,a.jsxs)(b.P.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:u.top+5,left:u.left,width:u.width},ref:z,onSubmit:e=>{e.preventDefault(),U()},children:[(0,a.jsx)("input",{type:"text",value:S,onChange:e=>_(e.target.value),placeholder:r.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,a.jsx)(j.N,{children:S.trim().length>0?(0,a.jsx)(b.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,a.jsx)(x.$,{onClick:()=>U(),"aria-label":r.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,a.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,a.jsx)(C.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var M=n(4262),S=n(46879);let _="opacity-30 blur-[2px]",A=e=>{let{isOpen:t,content:n,language:s,citations:l,type:r,showRaw:o,richSandboxRef:i,isCurrentStreaming:c,isChatStreaming:m,onSandboxConfirmation:f,onDOMContentLoaded:p,sendMessage:v,richSandboxCapabilities:x,isLatestVersion:y,artifactId:j,artifactContext:b,artifactVersion:w,onArtifactRuntimeError:C,artifact:k,hasMenuOpen:N,zoom:A,onTrackInteraction:R,showLoginModal:z,ArtifactMcpModal:L}=e,O=void 0!==r&&void 0!==n&&r!==u.vU.Code&&r!==u.vU.Markdown,F=(0,g.useRef)(null),I=O&&!o,[U,D]=(0,g.useState)(null),K=(0,g.useCallback)(e=>{void 0!==j&&void 0!==w&&(void 0!==C&&C(e),D({error:e,artifactId:j,artifactVersion:w}))},[j,w,C]);(0,g.useEffect)(()=>{var e;if(!k||!c)return;let t=k.versions[k.versions.length-1],n=k.versions[k.versions.length-2];if(!n||!t||"update"!==t.command)return;let a=P(n.resultState,t.resultState);-1!==a&&(null==(e=F.current)||e.scrollToPercentage(a/100))},[n,k,c]),(0,g.useEffect)(()=>{!c&&F.current&&F.current.enableScrolling()},[c]);let Z=(0,g.useCallback)(()=>{D(e=>e&&(e.artifactId!==j||e.artifactVersion!==w)?null:e)},[j,w]),Y=(0,g.useCallback)(()=>{D(null)},[]);return(0,a.jsxs)(a.Fragment,{children:[O&&(0,a.jsxs)("div",{className:(0,h.A)("ease-out duration-200",I?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",N&&_),children:[(0,a.jsx)(S.A,{ref:i,className:I?"h-full w-full border-none bg-bg-100":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:I?n:void 0,type:I?r:void 0,onSandboxConfirmation:f,onDOMContentLoaded:p,capabilities:x,onReportError:K,onSetContent:Z,onRefresh:Y,externalLinkBehavior:"ask",zoom:A,onTrackInteraction:R,showLoginModal:z,artifactContext:b,ArtifactMcpModal:L,isChatStreaming:m}),I&&U&&(0,a.jsx)(M.i,{error:U,handleClose:()=>D(null),sendMessage:y?v:void 0,isStreaming:m})]}),void 0===n||void 0===r?null:r===u.vU.Code||o?(0,a.jsx)(d.Z,{noDefaultScroll:!c,ref:F,className:(0,h.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",N&&_),children:(0,a.jsx)(E,{content:n,isStreaming:m,language:s,sendMessage:v,isOpen:t},"code-".concat(j,"-").concat(w,"-").concat(c))}):r===u.vU.Markdown?(0,a.jsx)(d.Z,{noDefaultScroll:!c,ref:F,className:(0,h.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",N&&_),children:(0,a.jsx)(T,{content:n,citations:l,isStreaming:m,sendMessage:v,isOpen:t},"markdown-".concat(j,"-").concat(w,"-").concat(c))}):null]})},E=e=>{let{content:t,isStreaming:n,language:r,sendMessage:o,isOpen:d}=e,{codeStyle:u}=(0,i.V)(),{exceedsSizeLimit:m}=(0,c.y)(t),h="code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed ";return(0,a.jsx)(k,{isStreaming:n,sendMessage:o,contentType:"code",isOpen:d,children:m?(0,a.jsx)(s.R,{code:t,codeClassName:"".concat(h," p-3.5")}):(0,a.jsx)(f.A,{className:h,language:r,PreTag:"div",style:u,renderer:l.G,children:t})})},T=e=>{let{content:t,citations:n,isStreaming:s,sendMessage:l,isOpen:i}=e,c=(0,m.n)(),d=(0,g.useMemo)(()=>c&&n&&n.length>0?(0,o.k0)(n,t):t,[t,n,c]);return(0,a.jsx)(k,{isStreaming:s,sendMessage:l,isOpen:i,children:(0,a.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-response mx-auto w-full max-w-3xl leading-[1.65rem] px-6 pt-4 md:pt-6 md:px-11",children:[(0,a.jsx)(r.fP,{text:d,blockCitations:n,className:"!gap-3.5",isStreaming:s,normalizationMode:"markdown-document"}),(0,a.jsx)("div",{className:"h-8"})]})})},P=(e,t)=>{if(!e||!t)return -1;let n=e.replace(/\\n/g,"\n"),a=t.replace(/\\n/g,"\n"),s=[...n].findIndex((e,t)=>e!==a[t]);if(-1===s&&n.length===a.length)return -1;let l=(n.slice(0,-1===s?n.length:s).match(/\n/g)||[]).length,r=(n.match(/\n/g)||[]).length;return r?Math.round(l/r*100):-1}},78540:(e,t,n)=>{n.d(t,{j:()=>r});var a=n(64328),s=n(68067),l=n(7620);let r=function(){let{artifactContext:e,onMissingOrganization:t,chatConversationUuid:n,onStorageChange:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:o}=(0,a.YL)(),i=(0,s.fS)("claude_create_pebble_stone"),c=(0,l.useCallback)(async function(a){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(a)),window.location.origin);t.searchParams.set("shared",s.toString()),n&&t.searchParams.set("chat_conversation_uuid",n);let l=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let r=await l.json();return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,n]),d=(0,l.useCallback)(async function(a,s){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=await fetch("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(a)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:s,shared:l,...n&&{chat_conversation_uuid:n}})});if(!t.ok)throw Error("Database error: ".concat(t.status));let i=await t.json();return null==r||r(),Promise.resolve(i)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,n,r]),u=(0,l.useCallback)(async function(a){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(a)),window.location.origin);t.searchParams.set("shared",s.toString()),n&&t.searchParams.set("chat_conversation_uuid",n);let l=await fetch(t.toString(),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let i=await l.json();return null==r||r(),Promise.resolve(i)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,n,r]),m=(0,l.useCallback)(async function(a){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage"),window.location.origin);a&&t.searchParams.set("prefix",a),t.searchParams.set("shared",s.toString()),n&&t.searchParams.set("chat_conversation_uuid",n);let l=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let r=await l.json();return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,n]);return{get:c,set:d,delete:u,list:m}}},85028:(e,t,n)=>{n.d(t,{Ns:()=>u,XJ:()=>d,mt:()=>c,r$:()=>i,rz:()=>m});var a=n(1613),s=n(64328),l=n(68067),r=n(4869);let o="artifact_tool_configuration",i="artifact_storage_info",c=e=>{let{entityId:t,artifactEntityType:n}=e,{activeOrganization:r}=(0,s.YL)(),i=null==r?void 0:r.uuid,c=(0,l.fS)("claude_create_marble");return(0,a.Sk)("/api/organizations/".concat(i,"/artifacts/").concat(n,"/").concat(t,"/tools"),{queryKey:[o,{orgUuid:i,entityId:t,artifactEntityType:n}],enabled:!!i&&!!t&&c,meta:{noToast:!0}})},d=e=>{let{entityId:t,artifactEntityType:n}=e,{activeOrganization:i}=(0,s.YL)(),c=null==i?void 0:i.uuid,d=(0,r.useQueryClient)(),u=(0,l.fS)("claude_create_marble");return(0,a.L2)("/api/organizations/".concat(c,"/artifacts/").concat(n,"/").concat(t,"/tools"),"POST",{enabled:!!c&&!!t&&u,onSuccess:()=>{d.invalidateQueries({queryKey:[o,{orgUuid:c,entityId:t,artifactEntityType:n}]})},meta:{noToast:!0}})},u=(e,t)=>{var n;let{entityId:r,artifactEntityType:o,conversationUuid:c}=e,{activeOrganization:d}=(0,s.YL)(),u=null==d?void 0:d.uuid,m=(0,l.fS)("claude_create_pebble_stone"),h=c?"/api/organizations/".concat(u,"/artifacts/").concat(o,"/").concat(r,"/manage/storage/info?chat_conversation_uuid=").concat(c):"/api/organizations/".concat(u,"/artifacts/").concat(o,"/").concat(r,"/manage/storage/info");return(0,a.Sk)(h,{queryKey:[i,{orgUuid:u,entityId:r,artifactEntityType:o,conversationUuid:c}],enabled:!!u&&!!r&&m&&(null==(n=null==t?void 0:t.enabled)||n),staleTime:0,meta:{noToast:!0}})},m=e=>{let{entityId:t,artifactEntityType:n,conversationUuid:o}=e,{activeOrganization:c}=(0,s.YL)(),d=null==c?void 0:c.uuid,u=(0,r.useQueryClient)(),m=(0,l.fS)("claude_create_pebble_stone"),h=o?"/api/organizations/".concat(d,"/artifacts/").concat(n,"/").concat(t,"/manage/storage/reset?chat_conversation_uuid=").concat(o):"/api/organizations/".concat(d,"/artifacts/").concat(n,"/").concat(t,"/manage/storage/reset");return(0,a.L2)(h,"DELETE",{enabled:!!d&&!!t&&m,onSuccess:()=>{u.invalidateQueries({queryKey:[i,{orgUuid:d,entityId:t,artifactEntityType:n,conversationUuid:o}]})},meta:{noToast:!0}})}}}]);